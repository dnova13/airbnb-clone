# 80 포트로 접근시 443 포트로 리다이렉트 시켜주는 설정
server {
    listen       80;
    server_name  _;
    return 301 https://$host$request_uri;
}


server {
	listen 443 ssl;
	
	server_name _;
	root /app/airbnb-clone;
	
	ssl_certificate /etc/certs/live/django.xyzzaabb.xyz/fullchain.pem;    # managed by Certbot 
  	ssl_certificate_key /etc/certs/live/django.xyzzaabb.xyz/privkey.pem;    # managed by Certbot 

	charset utf-8;
	client_max_body_size 80M;
	
	gzip on;
	gzip_types	application/json;
	gzip_min_length	1000;

	# 로그 생성 안되도록 설정
	# access_log off;
    # error_log /dev/null crit;

	location / {

		proxy_connect_timeout 60s;
		proxy_read_timeout 60s;
		proxy_send_timeout 60s;

		uwsgi_read_timeout 60s;
		uwsgi_send_timeout 60s;

		uwsgi_pass unix:///tmp/uwsgi_sock;
		include uwsgi_params;
	}

	location  /static/ {
   		alias  /app/airbnb-clone/staticfiles/;
  	}

	location  /media/ {
   		alias  /app/airbnb-clone/uploads/;
  	}

	location /ws {

		proxy_pass http://localhost:8000;
		proxy_http_version 1.1;

		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection "upgrade";

	}
}
